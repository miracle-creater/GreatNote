**发展背景**

文件总传输量增加，每个网页的文件读取数增加

**HTTP/1.1的缺陷**

> - 高延迟导致的页面加载速度降低
>
>   - **队头阻塞**导致带宽无法被利用
> 请求序列中有一个被阻塞，后面排队的也会一并阻塞
>     
> - 巨大的HTTP头部，有很多固定**头字段**，**响应报文**里也有很多重复内容有上千字节，而body只有几十字节
> - 明文传输的不安全性，所有传输内容都是明文，无法确保数据安全性
> - 不支持服务器推送消息

> **队头阻塞**解决方案：
>
> - chrome对于一个域名**默认允许同时建立6个TCP持久连接**，能公用一个TCP管道，**但一个管道同一时刻只能处理一个请求**，没有结束前只能处于阻塞状态。如果有10个请求，则有4个进入等待状态；
>- `Spriting`图，通过将多个图片合称为一张大图，通过CSS或者JS切割出来
> - 将图片的原始数据嵌入在CSS文件URL中
>   `icon{background: url(data:image/png;base64,<data>) no-repeat}`
> - 拼接将多个JavaScript文件通过`Webpack`打包成一个体积更大的JavaScript文件，但是这样会导致改变一部分JS代码就会重复下载整个JS文件

## SPDY协议和HTTP/2协议

> **SPDY**
>
> 谷歌公开了自行研发的 SPDY 协议，主要解决HTTP/1.1效率不高的问题
>
> 由于背负着 HTTP/1.x 庞大的历史包袱,所以协议的修改,兼容性是首要考虑的目标，否则就会破坏互联网上无数现有的资产。
>
> SPDY位于HTTP之下，TCP和SSL之上，这样可以轻松兼容老版本的HTTP协议(将HTTP1.x的内容封装成一种新的frame格式)，同时可以使用已有的SSL功能。
>
> **HTTP/2**
>
> HTTP/2基于SPDY，专注于性能，最大的一个目标是在用户和网站间只用一个连接（connection）。目前来看，能达到20%到60%的效率提升
>
> HTTP/2由两个规范（Specification）组成：
>
> - Hypertext Transfer Protocol version 2 - RFC7540
> - HPACK - Header Compression for HTTP/2 - RFC7541

### HTTP/2的新特性

> **2进制传输**
>
> 而不是HTTP/1.x里的纯文本方式，二进制协议解析起来更高效。HTTP/2将请求和相应分为更小的帧，并采用二进制编码。
>
> HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流。每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。**多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装**。

> **Header压缩**
>
> 开发了专门的"HPACK"算法，在客户端和服务器两端建立“字典”，用索引号表示重复的字符串，还采用哈夫曼编码来压缩整数和字符串，可以达到50%~90%的高压缩率。
>
> - 使用“首部表”跟踪和存储之前发送的键值对，对于相同的数据，不再通过每次请求发送
> - “首部表”在连接存续期内始终存在，由客户端和服务器共同渐进地更新
> - 每个新的首部键值要么追加到末尾，要么替换表中之前的值

> **多路复用**
>
> 多路复用很好的解决了浏览器限制同一域名下请求数量的问题，更容易实现全速传输，新开一个TCP连接都需要提升传输速度
>
> HTTP2的特性
>
> - 同域名下所有通信在单个连接上完成
> - 单个链接可以承载任意数量的双向数据流
> - 数据流以消息的形式发送，消息由一个或多个帧组成，多个帧在之间可以乱序发送，根据帧首部的流标识可以重新组装
>
> 性能提升：
>
> - 同一个域名只需要一个TCP连接(HTTP/1.1是多个文件多个TCP)，是用一个连接并行发送多个请求和相应，所以只需要一次慢启动
> - 并行交错地发送多个请求/响应，请求和响应之间互不影响。
> - HTTP/2中，每个请求都可以携带一个31bit的优先值，数值越大越优先，客户端可以根据优先值采取不同策略，使用最优方式发送数据流，消息、帧

> **Server Push**
>
> 服务器不再完全被动的响应请求，可以新建"流"，主动向客户端发送消息
>
> 比如，请求HTML时就把服务器可能会用到的CSS，JS文件发送给客户端，减少等待的延迟被称为(Server Push，也叫Cache push)
>
> 客户端有权利选择是否接受，如果推送的资源已经被浏览器缓存过，可以通过发送帧RES_STREAM帧来拒收，主动推送也必须遵守同源策略。

> **提高安全性**
>
> 处于兼容性考虑，延续了HTTP/1的“明文”的特点，可以像以前一样使用明文传输数据，不强制使用加密通信，不过格式是二进制的，只是不需要解密
>
> 主流浏览器都宣布只支持加密的HTTP/2，所以能见到的HTTP/2都是https协议名，跑在TLS上，"h2"表示加密的HTTP/2，"h2c"表示明文的HTTP/2